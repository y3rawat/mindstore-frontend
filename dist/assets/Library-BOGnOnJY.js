import{u as P,r as a,f as T,j as t,d as U}from"./index-Vtja1VBs.js";import{H as Q}from"./Header-JSs4fxmc.js";import{C as R}from"./ContentCard-DvhXQTgM.js";const j=20;function B(){const{user:f}=P(),l=f==null?void 0:f.id,[b,y]=a.useState([]),[E,u]=a.useState(!0),[h,N]=a.useState(!1),[i,k]=a.useState("all"),[c,I]=a.useState(""),[o,x]=a.useState([]),[S,C]=a.useState(!1),[M,D]=a.useState(1),[p,F]=a.useState(!0);a.useEffect(()=>{l?g(1,!0):(u(!1),y([]))},[l]);const g=a.useCallback(async(e=1,s=!1)=>{if(l){s?u(!0):N(!0);try{const n=await T(l,{limit:j,offset:(e-1)*j});if(n.success){const r=n.items||[];y(m=>s?r:[...m,...r]),F(r.length===j),D(e)}}catch(n){console.error("Failed to fetch content:",n)}finally{u(!1),N(!1)}}},[l]),$=()=>{!h&&p&&g(M+1,!1)},H=e=>{x(s=>s.includes(e)?s.filter(n=>n!==e):[...s,e])},_=async()=>{if(!(!l||o.length===0||!window.confirm(`Delete ${o.length} item${o.length>1?"s":""}?`))){C(!0);try{await U(o,l),await g(1,!0),x([])}catch(s){console.error("Failed to delete items:",s.message),alert(`Failed to delete: ${s.message}`)}finally{C(!1)}}};let d=i==="all"?b:b.filter(e=>{var s;return((s=e.media)==null?void 0:s.platform)===i});if(c){const e=c.toLowerCase();d=d.filter(s=>{var n,r,m,L,v,w;return((r=(n=s.media)==null?void 0:n.title)==null?void 0:r.toLowerCase().includes(e))||((L=(m=s.media)==null?void 0:m.author)==null?void 0:L.toLowerCase().includes(e))||((w=(v=s.media)==null?void 0:v.platform)==null?void 0:w.toLowerCase().includes(e))})}const A=["all","instagram","youtube","twitter","linkedin","tiktok"];return t.jsxs("div",{className:"library",children:[t.jsx(Q,{title:"Library",subtitle:"_your.archives",onSearch:I}),o.length>0&&t.jsxs("div",{className:"selection-bar",children:[t.jsxs("span",{className:"font-mono",children:[o.length," SELECTED"]}),t.jsxs("div",{className:"selection-actions",children:[t.jsx("button",{className:"btn btn-danger",onClick:_,disabled:S,children:S?"Deleting...":"Delete"}),t.jsx("button",{className:"btn btn-secondary",onClick:()=>x([]),children:"Clear"})]})]}),t.jsx("div",{className:"filter-tabs no-scrollbar",children:A.map(e=>t.jsx("button",{className:`filter-tab ${i===e?"active":""}`,onClick:()=>k(e),children:t.jsx("span",{className:"filter-label font-mono",children:e==="all"?"ALL":`#${e.toUpperCase()}`})},e))}),t.jsx("main",{className:"library-content",children:E?t.jsxs("div",{className:"loading-state",children:[t.jsx("div",{className:"loader-spinner"}),t.jsx("p",{className:"font-mono",children:"Loading archives..."})]}):d.length===0?t.jsxs("div",{className:"empty-state",children:[t.jsx("span",{className:"material-icons-round",children:"folder_open"}),t.jsx("h3",{children:"No content found"}),t.jsx("p",{className:"font-mono",children:c?"Try a different search":"Save content from the home screen"})]}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"content-grid",children:d.map(e=>t.jsx(R,{item:e,isSelected:o.includes(e.contentHash),onSelect:()=>H(e.contentHash)},e.contentHash||e.id))}),p&&i==="all"&&!c&&t.jsx("div",{className:"load-more",children:t.jsx("button",{className:"btn btn-secondary",onClick:$,disabled:h,children:h?"Loading...":"Load More"})})]})})]})}export{B as default};
